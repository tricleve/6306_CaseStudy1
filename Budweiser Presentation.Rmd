---
title: "Case Study: Budweiser Beer and Brewery Analysis"
output: html_document
Author: Cleveland
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
###Organized for Loading all Required Libraries

library(tidyverse)
library(maps)
library(mapproj)
library(usmap)
library(readr) #Read CSV
```

## Raw Data Set Load and Description
This is where we are loading the initial two data sets
Breweries Data: Contains Data on Unique Breweries and their location
Beers Data: Contains Data on the Beer provided by each Brewery
The Data Link between the two data sets is the Brew_ID

### Breweries
Brew_ID(Int): Unique Identifier of the brewery (Primary Key)
Name(Chr):    Name  of the brewery
State(chr):   State of where the brewery is located in the US (2 Letter Code)
City(chr):    City of where the brewery is located in the US

### Beers
Beer_ID(Int):     Unqiue Identifier of the specific beer (Primary Key)
Brewery_ID(Int):  Identifies which brewery the beer is associated with (Used to Merge)
ABV(num):         Alcohol by Volume of the beer
IBU(int):         International Bitterness Units Rating of the beer
Style(chr):       Style of the Beer
Ounces(num):      Ounces of the Beer

```{r Map Raw Data Load}
breweries  <- read.csv("Breweries.csv", sep = ',', header = TRUE)
beers      <- read.csv("Beers.csv", sep = ',', header = TRUE)
```

## Intial Exploratory Data Analysis & Data Clean Up
```{r Map Intial EDA}
head(breweries)
summary(breweries)
nrow(breweries)
ncol(breweries)

head(beers)
summary(beers)
nrow(beers)
ncol(beers)

###Data Clean Up

breweries$State = str_trim(breweries$State) #Remove Extra Space
colnames(breweries)[1] = "Brewery_id"       #For Clarity
colnames(beers)[5] = "Brewery_id"           #For Clarity
beers$Ounces
```

## Question 2 Merge the two Data Set Together
```{r Merge two datasests}
comb_data = full_join(beers,breweries, by="Brewery_id")
```

## Breweries in each state
```{r Map Breweries in Each State}


#Generate brewery count by state
brewery_count_by_state = count(breweries,State)

#Clean up column name to be more descriptive
colnames(brewery_count_by_state)[2] = "Breweries"

#Merge/select brewery count with statepop (usmap data set) to get fips for plot.
plotbrew = merge(statepop,brewery_count_by_state,by = "State") %>% select(fips, breweries)

#Plot brewery count on the state map.  Includes Alaska, Hawaii and DC
plot_usmap(data=plotbrew, values="Breweries", color = "black") + scale_fill_continuous(name = " Brewery Count", label = scales::comma) + theme(legend.position = "right")

plot_usmap(data=plotbrew, values="Breweries", color = "black") + scale_fill_gradient(name = " Brewery Count", low = "yellow", high = "red") + theme(legend.position = "right")
```

## Merge beer data with brewries data
```{r Merge Beer Data}
beers <- read.csv("C:/Users/johnc45/OneDrive - Nationwide/Desktop/Working/SMU/6306 - Doing Data Science/Unit 8 and 9 Case Study 1/Beers.csv")

comb_data = full_join(beers,breweries, by="Brewery_id")

tail(comb_data, 6)
head(comb_data, 6)

```


## Address Missing Values in each column
```{r Address Combined Data Missing Values}
beerclean = comb_data %>% filter (!is.na(ABV) & !is.na(IBU))

```

## Plot median ABV and IBU by state
```{r Plot median ABV and IBU by state}


##The two plots below display the median ABV and IBU 
plotABV <- beerclean %>% group_by(State) %>% summarise(medianABV= median(ABV)) %>% arrange(desc(medianABV)) 
plotABV$State <- factor(plotABV$State, levels = plotABV$State)

plotABV %>% ggplot(aes(State,medianABV, fill=medianABV))+geom_bar(stat="identity", width=.5)+ coord_cartesian(ylim=c(.03,.07)) + scale_fill_gradient(low = "yellow", high= "red")+ labs(title="Ordered Bar Chart", subtitle="Median ABV by State") + theme(axis.text.x = element_text(angle=65, vjust=.3)) 

plotIBU <- beerclean %>% group_by(State) %>% summarise(medianIBU= median(IBU)) %>% arrange(desc(medianIBU)) 
plotIBU$State <- factor(plotIBU$State, levels = plotIBU$State)

plotIBU %>% ggplot(aes(State,medianIBU, fill=medianIBU))+geom_bar(stat="identity", width=.5) + scale_fill_gradient(low = "yellow", high= "red")+ labs(title="Ordered Bar Chart", subtitle="Median IBU by State") + theme(axis.text.x = element_text(angle=65, vjust=.3)) 

## The two plots below present the states alphabetically.
beerclean %>% group_by(State) %>% summarise(medianABV= median(ABV))%>% ggplot(aes(State,medianABV, fill=medianABV))+geom_bar(stat="identity", width=.5)+ coord_cartesian(ylim=c(.03,.07)) + scale_fill_gradient(low = "yellow", high= "red")+ labs(title="Ordered Bar Chart", subtitle="Median ABV by State") + theme(axis.text.x = element_text(angle=65, vjust=.3)) 

beerclean %>% group_by(State) %>% summarise(medianIBU= median(IBU)) %>% ggplot(aes(State,medianIBU, fill=medianIBU))+geom_bar(stat="identity", width=.5) + scale_fill_gradient(low = "yellow", high= "red")+ labs(title="Ordered Bar Chart", subtitle="Median IBU by State") + theme(axis.text.x = element_text(angle=65, vjust=.3)) 

```

## Display the state with highest ABV and IBU
```{r Show states with highest ABV and IBU}

beerclean[grep(max(beerclean$ABV),beerclean$ABV),]
beerclean[grep(max(beerclean$IBU),beerclean$IBU),]

```